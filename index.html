
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>풍선 메시지</title>
    <style>
        body {
            background: linear-gradient(to bottom, #87cefa, #ffffff);
            overflow: hidden;
            font-family: "Segoe UI", sans-serif;
            margin: 0;
            padding: 0;
        }
        .balloon {
            position: absolute;
            padding: 12px 20px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 30px;
            animation-duration: 30s;
            animation-fill-mode: forwards;
            font-size: 1rem;
            color: #333;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            max-width: 280px;
            word-wrap: break-word;
            white-space: normal;
            text-align: center;
        }
        .balloon .nickname {
            display: block;
            margin-top: 6px;
            font-size: 0.9rem;
            font-weight: bold;
            color: #777;
        }
        @keyframes floatUp1 {
            0% { bottom: -60px; transform: translateX(0); opacity: 0; }
            50% { transform: translateX(-10px); opacity: 1; }
            100% { bottom: 100vh; transform: translateX(10px); opacity: 0; }
        }
        @keyframes floatUp2 {
            0% { bottom: -60px; transform: scale(1); opacity: 0; }
            50% { transform: scale(1.1); opacity: 1; }
            100% { bottom: 100vh; transform: scale(0.95); opacity: 0; }
        }
        @keyframes floatUp3 {
            0% { bottom: -60px; transform: rotate(0deg); opacity: 0; }
            50% { transform: rotate(2deg); opacity: 1; }
            100% { bottom: 100vh; transform: rotate(-2deg); opacity: 0; }
        }
    </style>
</head>
<body>
<script>
const sheetID = "1FUDbQsDeZBg8Pn7_ngzsk8OgB7fRZiIaIQi4eb-azQs";
const sheetName = "Form Responses 1";
const query = encodeURIComponent("SELECT B, C");
const url = `https://docs.google.com/spreadsheets/d/${sheetID}/gviz/tq?sheet=${sheetName}&tq=${query}`;

function createBalloon(message, name) {
    const div = document.createElement('div');
    div.className = 'balloon';
    div.setAttribute('role', 'alert');
    div.setAttribute('aria-label', message + (name ? ` from ${name}` : ""));

    div.style.left = Math.random() * 90 + 5 + '%';
    div.style.bottom = Math.floor(Math.random() * 6) * 15 + '%';
    div.style.backgroundColor = `hsl(${Math.random() * 360}, 70%, 90%)`;
    const anim = ['floatUp1', 'floatUp2', 'floatUp3'][Math.floor(Math.random() * 3)];
    div.style.animationName = anim;

    const msg = document.createElement('div');
    msg.textContent = message;
    const nick = document.createElement('span');
    nick.className = 'nickname';
    nick.textContent = name ? `— ${name}` : "";

    div.appendChild(msg);
    div.appendChild(nick);
    document.body.appendChild(div);
    setTimeout(() => div.remove(), 30000);
}

async function fetchMessages() {
    try {
        const res = await fetch(url);
        const text = await res.text();
        const match = text.match(/google.visualization.Query.setResponse\((.*)\);/s);
        if (!match || match.length < 2) throw new Error("Invalid GViz response format");
        const json = JSON.parse(match[1]);
        const rows = json.table.rows;
        if (!rows || rows.length === 0) return;

        let i = 0;
        function showNext() {
            const r = Math.floor(Math.random() * rows.length);
            const message = rows[r].c[0]?.v || "";
            const name = rows[r].c[1]?.v || "";
            if (message) createBalloon(message, name);
            i++;
            setTimeout(showNext, 500); // 0.5초 간격
        }
        showNext();

    } catch (err) {
        console.error("불러오기 실패:", err);
    }
}

function loopMessages() {
    fetchMessages().then(() => {
        setTimeout(loopMessages, 5000);
    });
}

loopMessages();
</script>
</body>
</html>
